<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard — ISUFST CareHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.min.css') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap"
        rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'display': ['"Plus Jakarta Sans"', 'sans-serif'], 'body': ['Inter', 'sans-serif'] },
                    colors: {
                        'primary': { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e3a5f', 900: '#0f1d30' },
                        'accent': '#10b981',
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        .sidebar-link {
            transition: all 0.2s ease;
        }

        .sidebar-link:hover,
        .sidebar-link.active {
            background: rgba(255, 255, 255, 0.12);
        }

        .stat-card {
            transition: all 0.3s cubic-bezier(.16, 1, .3, 1);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.1);
        }

        .expiring-soon {
            background-color: #fef2f2;
            border-left: 4px solid #ef4444;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 100px;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="flex h-screen overflow-hidden">
        <!-- ═══════════ SIDEBAR ═══════════ -->
        <aside
            class="w-[260px] bg-gradient-to-b from-primary-900 via-primary-800 to-primary-900 text-white flex-shrink-0 hidden lg:flex flex-col">
            <!-- Logo -->
            <div class="p-6 pb-4">
                <a href="/admin" class="flex items-center space-x-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-primary-600 to-accent rounded-xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-heartbeat text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold tracking-tight">CareHub</h1>
                        <p class="text-[11px] text-blue-300/60 font-medium uppercase tracking-wider">Admin Portal</p>
                    </div>
                </a>
            </div>

            <!-- Nav -->
            <nav class="flex-1 px-4 space-y-1 overflow-y-auto">
                <p class="text-[10px] text-blue-300/40 font-bold uppercase tracking-widest px-3 pt-4 pb-2">Overview</p>
                <a href="/admin"
                    class="sidebar-link active flex items-center space-x-3 px-3 py-2.5 rounded-xl text-sm font-medium">
                    <i class="fas fa-chart-pie w-5 text-center text-blue-300"></i><span>Dashboard</span>
                </a>

                <p class="text-[10px] text-blue-300/40 font-bold uppercase tracking-widest px-3 pt-6 pb-2">Management
                </p>
                <a href="{{ url_for('inventory.list_inventory') }}"
                    class="sidebar-link flex items-center space-x-3 px-3 py-2.5 rounded-xl text-sm font-medium text-blue-200/80">
                    <i class="fas fa-pills w-5 text-center text-blue-300/60"></i><span>Medicine Inventory</span>
                </a>
                <a href="#appointments-section"
                    class="sidebar-link flex items-center space-x-3 px-3 py-2.5 rounded-xl text-sm font-medium text-blue-200/80">
                    <i class="fas fa-calendar-check w-5 text-center text-blue-300/60"></i><span>Appointments</span>
                </a>
                <a href="#reservations-section"
                    class="sidebar-link flex items-center space-x-3 px-3 py-2.5 rounded-xl text-sm font-medium text-blue-200/80">
                    <i class="fas fa-hand-holding-heart w-5 text-center text-blue-300/60"></i><span>Reservations</span>
                </a>
                <a href="#queue-section"
                    class="sidebar-link flex items-center space-x-3 px-3 py-2.5 rounded-xl text-sm font-medium text-blue-200/80">
                    <i class="fas fa-users w-5 text-center text-blue-300/60"></i><span>Patient Queue</span>
                </a>
            </nav>

            <!-- User & Logout -->
            <div class="p-4 border-t border-white/10">
                <div class="flex items-center space-x-3 px-3 py-2 mb-2">
                    <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center text-xs font-bold">
                        {{ current_user.first_name[0] }}{{ current_user.last_name[0] }}
                    </div>
                    <div class="min-w-0">
                        <p class="text-sm font-semibold truncate">{{ current_user.first_name }} {{
                            current_user.last_name }}</p>
                        <p class="text-[11px] text-blue-300/50 capitalize">{{ current_user.role }}</p>
                    </div>
                </div>
                <a href="{{ url_for('auth.logout') }}"
                    class="sidebar-link flex items-center space-x-3 px-3 py-2.5 rounded-xl text-sm font-medium text-red-300/80 hover:text-red-200 hover:bg-red-500/10">
                    <i class="fas fa-sign-out-alt w-5 text-center"></i><span>Sign Out</span>
                </a>
            </div>
        </aside>

        <!-- ═══════════ MAIN CONTENT ═══════════ -->
        <div class="flex-1 overflow-y-auto">
            <!-- Top bar -->
            <header class="bg-white/80 backdrop-blur-xl border-b border-gray-100 px-6 lg:px-8 py-4 sticky top-0 z-10">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-extrabold text-gray-900">Dashboard</h2>
                        <p class="text-sm text-gray-500">Welcome back, <span class="font-semibold text-primary-700">{{
                                current_user.first_name }}</span></p>
                    </div>
                    <!-- Mobile menu -->
                    <div class="lg:hidden flex items-center space-x-3">
                        <a href="/admin" class="w-9 h-9 bg-primary-700 rounded-lg flex items-center justify-center">
                            <i class="fas fa-heartbeat text-white text-sm"></i>
                        </a>
                    </div>
                    <div class="hidden lg:flex items-center space-x-3">
                        <a href="/"
                            class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-primary-700 rounded-lg hover:bg-primary-50 transition-all">
                            <i class="fas fa-external-link-alt mr-1.5"></i>View Site
                        </a>
                    </div>
                </div>
            </header>

            <main class="p-6 lg:p-8 space-y-6">
                <!-- ── STAT CARDS ── -->
                <div class="grid grid-cols-2 lg:grid-cols-5 gap-4">
                    <div class="stat-card bg-white rounded-2xl border border-gray-100 p-5">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-user-injured text-primary-600"></i>
                            </div>
                        </div>
                        <p class="text-2xl font-extrabold text-gray-900">{{ today_patients }}</p>
                        <p class="text-xs text-gray-500 font-medium mt-1">Today's Patients</p>
                    </div>
                    <div class="stat-card bg-white rounded-2xl border border-gray-100 p-5">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-clock text-amber-600"></i>
                            </div>
                        </div>
                        <p class="text-2xl font-extrabold text-gray-900">{{ queue_count }}</p>
                        <p class="text-xs text-gray-500 font-medium mt-1">In Queue</p>
                    </div>
                    <div class="stat-card bg-white rounded-2xl border border-gray-100 p-5">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-calendar-check text-emerald-600"></i>
                            </div>
                        </div>
                        <p class="text-2xl font-extrabold text-gray-900">{{ today_appointments }}</p>
                        <p class="text-xs text-gray-500 font-medium mt-1">Appointments</p>
                    </div>
                    <div class="stat-card bg-white rounded-2xl border border-gray-100 p-5">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-500"></i>
                            </div>
                        </div>
                        <p
                            class="text-2xl font-extrabold {% if low_stock_count > 0 %}text-red-600{% else %}text-gray-900{% endif %}">
                            {{ low_stock_count }}</p>
                        <p class="text-xs text-gray-500 font-medium mt-1">Low Stock</p>
                    </div>
                    <div class="stat-card bg-white rounded-2xl border border-gray-100 p-5">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-violet-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-user-graduate text-violet-600"></i>
                            </div>
                        </div>
                        <p class="text-2xl font-extrabold text-gray-900">{{ total_students }}</p>
                        <p class="text-xs text-gray-500 font-medium mt-1">Students</p>
                    </div>
                </div>

                <!-- ── TWO COLUMN: QUEUE + APPOINTMENTS ── -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                    <!-- Queue Controller -->
                    <div id="queue-section" class="bg-white rounded-2xl border border-gray-100 p-6">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="text-lg font-bold text-gray-900 flex items-center">
                                <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-users text-amber-600 text-sm"></i>
                                </div>
                                Patient Queue
                            </h3>
                            <span class="px-3 py-1 bg-amber-50 text-amber-700 rounded-full text-xs font-bold">{{
                                queue_count }} waiting</span>
                        </div>

                        {% if next_patient %}
                        <div
                            class="bg-gradient-to-br from-primary-50 to-blue-50 rounded-xl p-6 border border-primary-100 mb-4">
                            <p class="text-[10px] font-bold text-primary-600 uppercase tracking-widest mb-1">Next
                                Patient</p>
                            <h4 class="text-xl font-extrabold text-primary-900 mb-3">{{ next_patient.student_name }}
                            </h4>
                            <div class="flex items-center space-x-3">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold
                                    {% if next_patient.severity_score == 1 %}bg-red-100 text-red-700
                                    {% elif next_patient.severity_score == 2 %}bg-yellow-100 text-yellow-700
                                    {% else %}bg-green-100 text-green-700{% endif %}">
                                    {{ next_patient.priority_label }}
                                </span>
                                <span class="text-xs text-gray-500">
                                    <i class="fas fa-clock mr-1"></i>{{ next_patient.arrival_time.strftime('%I:%M %p')
                                    }}
                                </span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <form method="POST" action="{{ url_for('queue.call_next') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit"
                                    class="w-full px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-semibold text-sm transition-all shadow-sm">
                                    <i class="fas fa-phone mr-2"></i>Call Next
                                </button>
                            </form>
                            <form method="POST" action="{{ url_for('queue.mark_absent', queue_id=next_patient.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit"
                                    class="w-full px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-semibold text-sm transition-all">
                                    <i class="fas fa-user-times mr-2"></i>Mark Absent
                                </button>
                            </form>
                        </div>
                        {% else %}
                        <div class="text-center py-8">
                            <div
                                class="w-14 h-14 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-check-circle text-gray-300 text-xl"></i>
                            </div>
                            <p class="text-sm text-gray-400 font-medium">Queue is empty</p>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Today's Appointments -->
                    <div id="appointments-section" class="bg-white rounded-2xl border border-gray-100 p-6">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="text-lg font-bold text-gray-900 flex items-center">
                                <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-calendar-check text-emerald-600 text-sm"></i>
                                </div>
                                Today's Appointments
                            </h3>
                            <span class="px-3 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-bold">{{
                                today_appointments }}</span>
                        </div>

                        {% if todays_appts %}
                        <div class="space-y-3 max-h-[320px] overflow-y-auto pr-1">
                            {% for appt in todays_appts %}
                            <div
                                class="flex items-center justify-between p-3 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors">
                                <div class="flex items-center space-x-3 min-w-0">
                                    <div
                                        class="w-9 h-9 bg-primary-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                        <i
                                            class="fas {% if appt.service_type == 'Dental' %}fa-tooth{% else %}fa-stethoscope{% endif %} text-primary-600 text-xs"></i>
                                    </div>
                                    <div class="min-w-0">
                                        <p class="text-sm font-semibold text-gray-900 truncate">{{
                                            appt.student.first_name }} {{ appt.student.last_name }}</p>
                                        <p class="text-xs text-gray-400">{{ appt.service_type }}</p>
                                    </div>
                                </div>
                                <div class="text-right flex-shrink-0 ml-3">
                                    <p class="text-sm font-bold text-primary-700">{{ appt.start_time.strftime('%I:%M
                                        %p') }}</p>
                                    <span class="text-[10px] font-semibold px-2 py-0.5 rounded-full
                                        {% if appt.status == 'Confirmed' %}bg-emerald-100 text-emerald-700
                                        {% elif appt.status == 'Pending' %}bg-amber-100 text-amber-700
                                        {% elif appt.status == 'Completed' %}bg-gray-100 text-gray-500
                                        {% else %}bg-red-100 text-red-600{% endif %}">
                                        {{ appt.status }}
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8">
                            <div
                                class="w-14 h-14 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-calendar text-gray-300 text-xl"></i>
                            </div>
                            <p class="text-sm text-gray-400 font-medium">No appointments today</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- ── TWO COLUMN: RESERVATIONS + EXPIRING ── -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                    <!-- Pending Reservations -->
                    <div id="reservations-section" class="bg-white rounded-2xl border border-gray-100 p-6">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="text-lg font-bold text-gray-900 flex items-center">
                                <div class="w-8 h-8 bg-violet-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-hand-holding-heart text-violet-600 text-sm"></i>
                                </div>
                                Pending Reservations
                            </h3>
                            <span class="px-3 py-1 bg-violet-50 text-violet-700 rounded-full text-xs font-bold">{{
                                pending_reservations|length }}</span>
                        </div>

                        {% if pending_reservations %}
                        <div class="space-y-3 max-h-[280px] overflow-y-auto pr-1">
                            {% for res in pending_reservations %}
                            <div class="flex items-center justify-between p-3 rounded-xl bg-gray-50">
                                <div class="flex items-center space-x-3 min-w-0">
                                    <div
                                        class="w-9 h-9 bg-violet-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-capsules text-violet-600 text-xs"></i>
                                    </div>
                                    <div class="min-w-0">
                                        <p class="text-sm font-semibold text-gray-900 truncate">{{ res.medicine_name }}
                                        </p>
                                        <p class="text-xs text-gray-400">{{ res.quantity }} unit(s) &middot; {{
                                            res.reserved_at.strftime('%b %d') }}</p>
                                    </div>
                                </div>
                                <span
                                    class="px-2.5 py-1 bg-amber-100 text-amber-700 rounded-full text-[10px] font-bold flex-shrink-0">Pickup</span>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8">
                            <div
                                class="w-14 h-14 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-box-open text-gray-300 text-xl"></i>
                            </div>
                            <p class="text-sm text-gray-400 font-medium">No pending pickups</p>
                        </div>
                        {% endif %}
                    </div>

                    <!-- Expiring Items -->
                    <div class="bg-white rounded-2xl border border-gray-100 p-6">
                        <div class="flex items-center justify-between mb-5">
                            <h3 class="text-lg font-bold text-gray-900 flex items-center">
                                <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-exclamation-triangle text-red-500 text-sm"></i>
                                </div>
                                Expiring Soon
                            </h3>
                            <a href="{{ url_for('inventory.list_inventory') }}"
                                class="text-xs font-semibold text-primary-600 hover:text-primary-800 transition-colors">
                                View All <i class="fas fa-arrow-right ml-1"></i>
                            </a>
                        </div>

                        {% if expiring_items %}
                        <div class="space-y-3">
                            {% for item in expiring_items %}
                            <div
                                class="flex items-center justify-between p-3 rounded-xl bg-red-50 border border-red-100">
                                <div class="flex items-center space-x-3 min-w-0">
                                    <div
                                        class="w-9 h-9 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                                        <i class="fas fa-pills text-red-500 text-xs"></i>
                                    </div>
                                    <div class="min-w-0">
                                        <p class="text-sm font-semibold text-gray-900 truncate">{{ item.name }}</p>
                                        <p class="text-xs text-gray-400">{{ item.quantity }} in stock &middot; {{
                                            item.batch_number or 'No batch' }}</p>
                                    </div>
                                </div>
                                <div class="text-right flex-shrink-0 ml-3">
                                    <p class="text-xs font-bold text-red-600">{{ item.expiry_date.strftime('%b %d') if
                                        item.expiry_date else 'N/A' }}</p>
                                    <a href="{{ url_for('inventory.edit', item_id=item.id) }}"
                                        class="text-[10px] text-primary-600 hover:text-primary-800 font-semibold">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-8">
                            <div
                                class="w-14 h-14 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-check-circle text-emerald-300 text-xl"></i>
                            </div>
                            <p class="text-sm text-gray-400 font-medium">No items expiring soon</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="bg-white rounded-2xl border border-gray-100 p-6">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                        <a href="{{ url_for('inventory.add') }}"
                            class="flex items-center space-x-3 p-4 rounded-xl bg-primary-50 hover:bg-primary-100 transition-all group">
                            <div
                                class="w-10 h-10 bg-primary-100 group-hover:bg-primary-200 rounded-xl flex items-center justify-center transition-colors">
                                <i class="fas fa-plus text-primary-600"></i>
                            </div>
                            <span class="text-sm font-semibold text-primary-800">Add Medicine</span>
                        </a>
                        <a href="{{ url_for('inventory.list_inventory') }}"
                            class="flex items-center space-x-3 p-4 rounded-xl bg-emerald-50 hover:bg-emerald-100 transition-all group">
                            <div
                                class="w-10 h-10 bg-emerald-100 group-hover:bg-emerald-200 rounded-xl flex items-center justify-center transition-colors">
                                <i class="fas fa-warehouse text-emerald-600"></i>
                            </div>
                            <span class="text-sm font-semibold text-emerald-800">Inventory</span>
                        </a>
                        <a href="{{ url_for('reservations.view_medicines') }}"
                            class="flex items-center space-x-3 p-4 rounded-xl bg-violet-50 hover:bg-violet-100 transition-all group">
                            <div
                                class="w-10 h-10 bg-violet-100 group-hover:bg-violet-200 rounded-xl flex items-center justify-center transition-colors">
                                <i class="fas fa-capsules text-violet-600"></i>
                            </div>
                            <span class="text-sm font-semibold text-violet-800">Medicines</span>
                        </a>
                        <a href="/"
                            class="flex items-center space-x-3 p-4 rounded-xl bg-gray-50 hover:bg-gray-100 transition-all group">
                            <div
                                class="w-10 h-10 bg-gray-100 group-hover:bg-gray-200 rounded-xl flex items-center justify-center transition-colors">
                                <i class="fas fa-home text-gray-600"></i>
                            </div>
                            <span class="text-sm font-semibold text-gray-800">View Site</span>
                        </a>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Mobile bottom nav -->
    <div class="lg:hidden fixed bottom-0 inset-x-0 bg-white border-t border-gray-200 px-4 py-2 z-50">
        <div class="flex items-center justify-around">
            <a href="/admin" class="flex flex-col items-center py-1 text-primary-700">
                <i class="fas fa-chart-pie text-lg"></i>
                <span class="text-[10px] font-semibold mt-0.5">Dashboard</span>
            </a>
            <a href="{{ url_for('inventory.list_inventory') }}" class="flex flex-col items-center py-1 text-gray-400">
                <i class="fas fa-pills text-lg"></i>
                <span class="text-[10px] font-semibold mt-0.5">Inventory</span>
            </a>
            <a href="#queue-section" class="flex flex-col items-center py-1 text-gray-400">
                <i class="fas fa-users text-lg"></i>
                <span class="text-[10px] font-semibold mt-0.5">Queue</span>
            </a>
            <a href="{{ url_for('auth.logout') }}" class="flex flex-col items-center py-1 text-gray-400">
                <i class="fas fa-sign-out-alt text-lg"></i>
                <span class="text-[10px] font-semibold mt-0.5">Logout</span>
            </a>
        </div>
    </div>
</body>

</html>