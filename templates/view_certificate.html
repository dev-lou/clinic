{% extends 'admin_base.html' %}

{% block title %}View Certificate{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6 max-w-3xl">
    <div class="mb-6">
        <a href="{{ url_for('certificates.admin_certificates') }}" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
            <i class="fas fa-arrow-left mr-1"></i> Back to Certificates
        </a>
        <div class="flex items-center justify-between mt-3">
            <h1 class="text-2xl font-bold text-gray-900">Health Certificate</h1>
            <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">
                <i class="fas fa-check-circle mr-1"></i>Valid
            </span>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <!-- Certificate Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-6 py-4">
            <h2 class="text-xl font-bold text-white">{{ certificate.certificate_number }}</h2>
            <p class="text-blue-100 text-sm mt-1">Official Health Certificate</p>
        </div>

        <!-- Certificate Details -->
        <div class="p-6">
            <!-- Student Information -->
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">Student Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-xs text-gray-500">Full Name</p>
                        <p class="font-semibold text-gray-900">{{ student.user.full_name }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Student ID</p>
                        <p class="font-semibold text-gray-900">{{ student.student_id }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Course</p>
                        <p class="font-semibold text-gray-900">{{ student.course }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Year Level</p>
                        <p class="font-semibold text-gray-900">
                            {% if student.year_level %}
                                {{ student.year_level }}{{ 'st' if student.year_level == 1 else 'nd' if student.year_level == 2 else 'rd' if student.year_level == 3 else 'th' }} Year
                            {% else %}
                                N/A
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Certificate Information -->
            <div class="mb-6 pb-6 border-b border-gray-200">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3">Certificate Information</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-xs text-gray-500">Purpose</p>
                        <p class="font-semibold text-gray-900">{{ certificate.purpose }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Issued Date</p>
                        <p class="font-semibold text-gray-900">{{ certificate.issued_at.strftime('%B %d, %Y') }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Valid Until</p>
                        <p class="font-semibold text-gray-900">{{ certificate.valid_until.strftime('%B %d, %Y') }}</p>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Issued By</p>
                        <p class="font-semibold text-gray-900">{{ issuer.full_name }}</p>
                        <p class="text-xs text-gray-500">{{ issuer.role|title }}</p>
                    </div>
                </div>
            </div>

            <!-- Medical Findings -->
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Medical Findings</h3>
                <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-gray-700 text-sm whitespace-pre-line">{{ certificate.medical_findings }}</p>
                </div>
            </div>

            <!-- Digital Signature -->
            {% if certificate.digital_signature %}
            <div class="mb-6">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Digital Signature</h3>
                <div class="bg-blue-50 rounded-lg p-3">
                    <p class="text-xs font-mono text-blue-900 break-all">{{ certificate.digital_signature }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Actions -->
            <div class="flex gap-3 pt-4 border-t border-gray-200">
                <a 
                    href="{{ url_for('certificates.download_certificate', cert_id=certificate.id) }}" 
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-medium text-center transition"
                >
                    <i class="fas fa-download mr-2"></i>Download PDF
                </a>
                {% if current_user.role == 'admin' %}
                <form method="POST" action="{{ url_for('certificates.delete_certificate', cert_id=certificate.id) }}" onsubmit="return confirm('Are you sure you want to delete this certificate?')" class="flex-1">
                    <button 
                        type="submit" 
                        class="w-full bg-red-600 hover:bg-red-700 text-white px-6 py-2.5 rounded-lg font-medium transition"
                    >
                        <i class="fas fa-trash mr-2"></i>Delete Certificate
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Certificate Preview Info -->
    <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-blue-600 text-lg"></i>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-semibold text-blue-900">Certificate Information</h3>
                <p class="text-xs text-blue-800 mt-1">This certificate is valid until {{ certificate.valid_until.strftime('%B %d, %Y') }}. Click "Download PDF" to get an official printable copy with the ISU header and authorized signatures.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
